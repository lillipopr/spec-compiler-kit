# 功能变更 SOP

## 概述

功能变更的核心是控制影响面，避免引入状态爆炸。

## Step 1（人）：状态差异分析

- 画「新旧状态差异图」
- 识别：新增/合并/删除的状态
- 产出：《状态差异分析文档》

### 变更影响矩阵

| 变更类型 | 影响范围 | 处理方式 |
|---------|---------|----------|
| 仅影响 UI 展示 | 用例文档 + 接口设计 | 局部更新 |
| 影响业务逻辑 | 约束定义 + 用例文档 + 接口设计 | 返回 Phase 2-3 |
| 影响状态空间 | 所有四个阶段文档 | 返回 Phase 1 |
| 影响架构设计 | 需要架构评审 | 切换到架构设计模式 |

## Step 2（AI）：影响面标记

- 标记受影响的用例
- 自动生成新用例
- 产出：《影响面分析》

## Step 3（人）：审核

- 确认是否引入状态爆炸
- 确认是否破坏可逆性
- **闸口**：状态爆炸则重新设计

### 状态爆炸检查

状态数量 = 当前状态数 × 新增维度

如果状态增长超过 50%，需要重新设计状态空间。

## Step 4（AI）：修改实现

- 修改代码
- 更新测试
- 产出：代码变更

## Step 5（人）：验收并归档

---

## 版本标注格式

```markdown
# {功能名称} - 问题建模文档

**版本**：v1.1
**变更日期**：2025-01-29
**变更说明**：增加 Apple 授权登录方式
```
