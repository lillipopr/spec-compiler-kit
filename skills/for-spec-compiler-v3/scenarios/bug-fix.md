# Bug 修复 SOP

## 核心原则

**Bug 本质是：系统状态空间被低估了**

不要直接改代码，先建模再修复。

## Step 1（人）：复现并用例化

- 复现 bug
- 将 bug 转化为失败用例
- 产出：《Bug 用例》
- **闸口**：没有用例，不允许改代码

### Bug 用例格式

```markdown
### Case-Bug-01：{Bug 描述}

**前置条件（Given）**：
- {复现条件}

**触发行为（When）**：
- {触发操作}

**预期结果（Then）**：
- {正确行为}

**实际结果（Actual）**：
- {错误行为}
```

## Step 2（人）：分析未建模状态

- 这个 bug 暴露了什么未建模状态？
- 是否需要更新不变量？
- 产出：《状态补充说明》

### 分析检查清单

- [ ] 是否有遗漏的状态转移？
- [ ] 不变量是否完整？
- [ ] 边界条件是否考虑？
- [ ] 并发场景是否处理？

## Step 3（AI）：修复

- 根据用例修改代码
- 产出：修复代码

## Step 4（人）：确认

- 确认是否引入新状态
- 用例通过后归档

---

## 反模式警告

❌ **不要**：
- 看到代码 bug 直接改
- 加 if 判断处理特殊情况
- 加"try-catch"吞掉异常

✅ **应该**：
- 先写失败用例
- 分析未建模状态
- 更新约束和用例
- 再修复代码
