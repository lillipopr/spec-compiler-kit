---
description: 调用规格编译器，执行 4 Phase 规格编译流程（问题建模 → 约束定义 → 用例设计 → 端到端接口设计）。Phase 1-3 完成后必须等待用户确认才能继续。
---

# /spec - 规格编译器命令

此命令调用 **spec-compiler-v4** Agent，执行完整的规格编译流程。

## 此命令的作用

1. **Phase 1: 问题建模** - 实体抽取、状态定义、不变量定义、状态转移图
2. **Phase 2: 约束定义** - 约束伪代码/DSL、各端实现位置、状态转移表
3. **Phase 3: 用例设计** - 正向用例、Bad Case、边界用例、用例覆盖矩阵
4. **Phase 4: 端到端接口设计** - 完整接口规格、各端实现位置、接口契约一致性
5. **人工审查闸口** - Phase 1-3 完成后必须等待用户确认

## 何时使用

使用 `/spec` 时：
- 已有 PRD 和 DDD 设计文档，需要生成规格文档
- 需要修改现有规格文档
- 需要审查规格文档的完整性
- 需要确保跨端接口契约一致性

## 工作流程

### 1. 创建规格文档

**前提条件**：已有 PRD 和 DDD 设计文档

**输入**：PRD 文档路径、DDD 文档路径

**执行流程**：
1. 调用 `spec-compiler-v4` Agent
2. 执行 4 Phase 编译流程：

**Phase 1: 实体抽取**
- 从 DDD 设计中抽取实体
- 定义实体属性和关系
- 明确状态空间

**Phase 2: 用例推导**
- 分析实体交互
- 推导正常路径用例
- 推导异常路径用例
- 定义不变量约束

**Phase 3: 跨端统一建模**
- 设计端到端接口
- 定义请求/响应格式
- 明确错误处理

**Phase 4: 端到端接口串联**
- 串联各端接口
- 验证契约一致性
- 生成实现映射

**每个 Phase 完成后等待人工审查确认**

**产出**：《规格建模文档.md》

### 2. 修改规格文档

**输入**：现有规格文档、变更说明

**执行流程**：
1. 调用 `spec-compiler-v4` Agent
2. 分析变更影响范围
3. 更新相关 Phase
4. 重新执行受影响的推导
5. 标记变更版本

**产出**：更新后的规格文档

### 3. Review 规格文档

**输入**：待审查的规格文档

**执行流程**：
1. 调用 `spec-compiler-v4` Agent
2. 检查实体定义完整性
3. 验证用例覆盖度
4. 检查不变量完整性
5. 验证接口契约一致性
6. 输出审查报告

**产出**：规格文档审查报告

## 质量闸口

| 检查项 | 标准 |
|--------|------|
| 实体定义 | 唯一 ID、生命周期、状态转移完整 |
| 用例覆盖 | 覆盖所有状态转移和异常场景 |
| 不变量 | 每个状态转移都有不变量约束 |
| 接口契约 | 请求/响应/错误处理完整 |
| 跨端一致 | 各端接口契约一致 |

## 与其他命令的集成

**前置命令：**
- `/prd` - 创建 PRD 文档（规格编译的输入）
- `/ddd` - 创建 DDD 设计文档（规格编译的输入）

**后续命令：**
- `/java` - 实现后端代码（基于规格文档）
- `/ios` - 实现 iOS 代码（基于规格文档）
- `/front` - 实现前端代码（基于规格文档）
- `/tdd` - 编写测试用例（基于规格文档）

## 相关 Agent

此命令调用位于以下位置的 `spec-compiler-v4` Agent：
`./agents/spec-compiler-v4.md`

并可引用位于以下位置的 `for-spec-compiler-v4` Skill：
`./skills/for-spec-compiler-v3/SKILL.md`

## 4 Phase 流程

```
┌─────────────────────────────────────────────────────────────────┐
│                      4 Phase 编译流程                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Phase 1: 实体抽取        │
│  ├─ 输入: PRD + DDD                                              │
│  ├─ 产出: 实体定义、状态空间                                      │
│  └─ 闸口: 实体属性完整、状态转移清晰                               │
│           ↓ 人工审查确认                                          │
│  Phase 2: 用例推导       │
│  ├─ 输入: 实体定义 + 业务场景                                     │
│  ├─ 产出: 正常用例 + 异常用例 + 不变量                             │
│  └─ 闸口: 用例覆盖完整、不变量合理                                 │
│           ↓ 人工审查确认                                          │
│  Phase 3: 跨端统一建模                                           │
│  ├─ 输入: 用例 + 技术约束                                         │
│  ├─ 产出: 接口定义、数据契约                                      │
│  └─ 闸口: 接口完整、契约一致                                       │
│           ↓ 人工审查确认                                          │
│  Phase 4: 端到端接口串联                                         │
│  ├─ 输入: 接口定义 + 各端规范                                     │
│  ├─ 产出: 端到端流程、实现映射                                     │
│  └─ 闸口: 流程完整、映射清晰                                       │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## 相关文档

- [规格编译器 Skill](../skills/for-spec-compiler-v4/SKILL.md)
- [4 Phase SOP](../skills/for-spec-compiler-v4/references/sop/phase-workflow.md)
- [规格模板](../skills/for-spec-compiler-v4/references/templates/spec-template.md)

## 示例

```
用户: /spec

Claude: 请选择场景：
1. 创建规格文档（4 Phase 流程）
2. 修改规格文档
3. Review 规格文档

用户: 1

Claude: 请提供 PRD 和 DDD 文档路径...

[Phase 1: 实体抽取完成]
[等待用户审查确认...]

[Phase 2: 用例推导完成]
[等待用户审查确认...]

...
```
