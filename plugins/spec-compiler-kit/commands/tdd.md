---
description: 强制执行测试驱动开发工作流。先搭建接口、先生成测试（RED），然后实现最小代码（GREEN），最后重构（REFACTOR）。确保 80%+ 覆盖率。
---

# /tdd - TDD 测试专家命令

此命令调用 **tdd-expert** Agent，强制执行测试驱动开发（TDD）方法论。

## 此命令的作用

1. **搭建接口** - 首先定义类型/接口
2. **先生成测试** - 编写失败的测试（RED）
3. **实现最小代码** - 编写刚好能通过的代码（GREEN）
4. **重构** - 在保持测试通过的同时改进代码（REFACTOR）
5. **验证覆盖率** - 确保 80%+ 测试覆盖率

## 何时使用

使用 `/tdd` 时：
- 实现新功能
- 添加新函数/组件
- 修复 bug（先编写重现 bug 的测试）
- 重构现有代码
- 构建核心业务逻辑

## TDD 循环

```
RED → GREEN → REFACTOR → REPEAT

RED:      编写失败的测试
GREEN:    编写最小代码使其通过
REFACTOR: 改进代码，保持测试通过
REPEAT:   下一个功能/场景
```

## 工作流程

### 1. 编写单元测试

**前提条件**：已有代码实现

**输入**：代码文件路径或功能描述

**执行流程**：
1. 调用 `tdd-expert` Agent
2. 分析代码结构
3. 遵循 TDD 原则：
   - 先写测试（RED）
   - 实现代码（GREEN）
   - 重构优化（REFACTOR）
4. 确保覆盖率 80%+
5. 验证测试质量

**产出**：单元测试代码

### 2. 编写集成测试

**前提条件**：有接口定义或服务边界

**输入**：接口文档或服务描述

**执行流程**：
1. 调用 `tdd-expert` Agent
2. 设计集成测试场景
3. Mock 外部依赖
4. 编写集成测试用例
5. 验证接口契约

**产出**：集成测试代码

### 3. 编写端到端测试

**前提条件**：有用户流程定义

**输入**：用户流程描述

**执行流程**：
1. 调用 `tdd-expert` Agent
2. 设计 E2E 测试场景
3. 使用 Playwright 编写测试
4. 覆盖关键用户路径
5. 验证跨端协作

**产出**：E2E 测试代码

### 4. 执行测试

**输入**：测试类型或测试路径

**执行流程**：
1. 调用 `tdd-expert` Agent
2. 执行指定测试
3. 分析测试结果
4. 失败时提供修复建议
5. 生成测试报告

**产出**：测试执行报告

## TDD 工作流

```
RED（写测试）→ GREEN（实现）→ REFACTOR（重构）
     ↑                            |
     |____________________________|
           循环直到通过
```

## 质量标准

| 测试类型 | 覆盖率要求 | 验证重点 |
|----------|-----------|----------|
| 单元测试 | 80%+ | 业务逻辑、边界条件 |
| 集成测试 | 关键路径 100% | 接口契约、协作流程 |
| E2E 测试 | 核心流程 100% | 用户价值、跨端协作 |

## 与其他命令的集成

- `/spec` - 基于规格文档编写测试
- `/java`、`/ios`、`/front` - 实现代码后补充测试

## 相关 Agent

此命令调用位于以下位置的 `tdd-expert` Agent：
`./agents/tdd-expert.md`

并可引用位于以下位置的 `for-tdd-expert` Skill：
`./skills/for-tdd-expert/SKILL.md`

## 示例

```
用户: /tdd

Claude: 请选择场景：
1. 编写单元测试
2. 编写集成测试
3. 编写端到端测试
4. 执行测试

用户: 1

Claude: 请提供要测试的代码路径或功能描述...

[调用 tdd-expert Agent，遵循 TDD 工作流]
```
