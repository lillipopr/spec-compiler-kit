---
description: 用户故事编写方法论 - INVEST 原则、验收标准
---

# 用户故事编写方法论

## 概述
用户故事是敏捷开发的核心工件，它从用户视角描述功能需求，是连接业务需求和技术实现的桥梁。

## 核心结构

```
作为 <用户角色>
我想要 <执行的操作>
以便 <获得的价值>
```

## 1. 用户故事结构

### 1.1 标准三段式

```gherkin
作为 [用户角色]
我想要 [执行的操作]
以便 [获得的价值]
```

**示例**：

```gherkin
作为 会员用户
我想要 每天自动获得100点券
以便 我可以使用点券兑换商品
```

### 1.2 三要素说明

| 要素 | 说明 | 常见错误 |
|-----|------|----------|
| **用户角色** | 谁在使用？ | 写成"用户"太笼统 |
| **操作** | 想要做什么？ | 写成技术实现 |
| **价值** | 为什么要做？ | 价值不明确或缺失 |

### 1.3 完整用户故事（3C）

```
Card（卡片） → Conversation（对话） → Confirmation（确认）
```

| 3C | 说明 | 产出 |
|----|------|------|
| **Card** | 故事卡片，简短描述 | 用户故事标题 |
| **Conversation** | 详细讨论，澄清细节 | 产品文档、原型 |
| **Confirmation** | 验收标准，测试依据 | 验收标准 |

## 2. INVEST 原则

### 2.1 原则详解

| 原则 | 说明 | 检查问题 |
|-----|------|----------|
| **I**ndependent | 独立的，可单独交付 | 做完就能用吗？ |
| **N**egotiable | 可协商的，细节可讨论 | 还有讨论空间吗？ |
| **V**aluable | 有价值的，对用户有意义 | 用户感知到价值了吗？ |
| **E**stimable | 可估算的，工作量可评估 | 能估算工作量吗？ |
| **S**mall | 小的，单次迭代可完成 | 不会太大吗？ |
| **T**estable | 可测试的，有验收标准 | 能写测试用例吗？ |

### 2.2 INVEST 检查清单

- [ ] **独立**：与其他故事无强依赖
- [ ] **可协商**：细节留有讨论空间
- [ ] **有价值**：用户/业务有价值
- [ ] **可估算**：开发能评估工作量
- [ ] **小**：3-5天可完成
- [ ] **可测试**：能写出验收标准

## 3. 用户角色定义

### 3.1 角色分类

| 类型 | 说明 | 示例 |
|-----|------|------|
| **主要角色** | 核心用户，主要服务对象 | 买家、卖家 |
| **次要角色** | 偶尔使用，辅助角色 | 客服、管理员 |
| **后台角色** | 系统角色，不可见 | 定时任务、第三方系统 |

### 3.2 角色定义方法

#### Persona 法
```markdown
# 用户角色：职场新人小王
- 年龄：25岁
- 职业：互联网公司运营
- 痛点：工作任务多，经常忘记
- 目标：高效管理任务
```

#### 场景法
```markdown
# 使用场景
小王每天有几十项工作任务，
经常忘记重要事项，
需要提醒功能帮助记忆。
```

### 3.3 角色命名建议

```
✅ 好的角色命名
- 会员用户
- 商家
- 运营人员
- 系统管理员

❌ 差的角色命名
- 用户（太笼统）
- 客户（不明确）
- 后台（不是角色）
```

## 4. 用户故事类型

### 4.1 按功能类型分类

#### 功能型故事

```gherkin
作为 会员用户
我想要 每天获得100点券
以便 我可以使用点券兑换商品
```

**特点**：新增功能

#### 优化型故事

```gherkin
作为 运营人员
我想要 批量导入用户
以便 减少90%的手动录入时间
```

**特点**：提升效率、体验

#### 缺陷型故事

```gherkin
作为 用户
我想要 支付失败时看到明确原因
以便 我知道如何修正支付信息
```

**特点**：修复问题

### 4.2 按价值层次分类

#### 基本需求故事

```gherkin
作为 用户
我想要 登录系统
以便 我可以使用系统功能
```

**特点**：必须有，没有不行

#### 期望需求故事

```gherkin
作为 用户
我想要 快速搜索商品
以便 我能快速找到想要的商品
```

**特点**：越多越好

#### 兴奋需求故事

```gherkin
作为 用户
我想要 AI推荐我可能喜欢的商品
以便 我能发现新商品
```

**特点**：超出预期

## 5. 验收标准

### 5.1 Given-When-Then 格式

```gherkin
Given <前置条件>
When <触发动作>
Then <预期结果>
```

**示例**：

```gherkin
Given 用户是有效会员（状态=生效中）
When 时间到达每日00:00
Then 用户账户增加100点券
And 用户收到点券到账通知
```

### 5.2 验收标准覆盖

| 场景类型 | 说明 | 示例 |
|---------|------|------|
| **正向场景** | 正常流程 | 用户成功下单 |
| **边界场景** | 边界条件 | 库存为0、超时 |
| **异常场景** | 错误处理 | 网络异常、服务故障 |

### 5.3 验收标准原则

- **可测试**：能写成自动化测试
- **明确**：没有歧义
- **完整**：覆盖所有场景
- **可量化**：有具体指标

### 5.4 验收标准示例

```gherkin
## AC-1: 正常发放
Given 用户是有效会员（状态=生效中）
When 时间到达每日00:00
Then 用户账户增加100点券

## AC-2: 边界场景-刚开通
Given 用户刚刚开通会员（23:59）
When 当日00:00到达
Then 不发放当日点券
And 从次日开始发放

## AC-3: 异常场景-服务故障
Given 用户是有效会员
When 点券发放服务故障
Then 记录发放失败日志
And 服务恢复后24小时内补发
```

## 6. 用户故事拆分

### 6.1 拆分原则

```
大故事 → 按用户流程拆分 → 小故事（符合INVEST）
```

### 6.2 拆分方法

#### 按用户流程拆分

```
大故事：用户可以购买商品

拆分：
1. 浏览商品列表
2. 查看商品详情
3. 加入购物车
4. 提交订单
5. 支付订单
```

#### 按数据拆分

```
大故事：用户中心

拆分：
1. 基础信息（昵称、头像）
2. 账户安全（密码、手机）
3. 地址管理
4. 实名认证
```

#### 按复杂度拆分（MVP）

```
大故事：智能推荐

拆分：
1. 热门推荐（基于热门度）
2. 协同过滤（基于用户行为）
3. 深度学习（基于算法）
```

### 6.3 拆分示例

#### 不当拆分

```
❌ 按技术拆分
- 前端页面
- 后端接口
- 数据库设计

问题：没有用户价值
```

#### 正确拆分

```
✅ 按用户价值拆分
- 浏览商品列表（用户能看商品）
- 查看商品详情（用户能了解商品）
- 加入购物车（用户能暂存商品）
```

## 7. 用户故事模板

### 7.1 基础模板

```markdown
## 用户故事：[故事标题]

### 故事描述
作为 [用户角色]
我想要 [执行的操作]
以便 [获得的价值]

### 验收标准
#### AC-1: [标准名称]
Given [前置条件]
When [触发动作]
Then [预期结果]

#### AC-2: [标准名称]
...

### 优先级
P0 / P1 / P2

### 估算工作量
[X] 人天

### 依赖
- 依赖的其他故事
```

### 7.2 完整模板

```markdown
## 用户故事：会员每日点券发放

### 故事描述
作为 会员用户
我想要 每天自动获得100点券
以便 我可以使用点券兑换商品

### 用户角色
- 目标用户：有效会员（状态=生效中）
- 使用场景：会员每天登录查看点券

### 验收标准
#### AC-1: 正常发放
Given 用户是有效会员（状态=生效中）
And 开通时间超过24小时
When 时间到达每日00:00
Then 用户账户增加100点券
And 用户收到点券到账通知

#### AC-2: 边界-刚开通
Given 用户刚刚开通会员（23:59）
When 当日00:00到达
Then 不发放当日点券
And 从次日开始发放

#### AC-3: 异常-服务故障
Given 用户是有效会员
When 点券发放服务故障
Then 记录发放失败日志
And 服务恢复后24小时内补发
And 不影响用户其他功能

### 非功能需求
- 性能：发放延迟<5秒
- 可用性：99.9%

### 优先级
P0

### 估算工作量
5人天

### 依赖
- 上游：会员服务已就绪
- 下游：点券服务需同步支持
```

## 8. 常见错误

### 8.1 角色错误

```
❌ 作为用户
✅ 作为会员用户

❌ 作为客户端
✅ 作为移动端用户
```

### 8.2 操作错误

```
❌ 我想要一个搜索接口
✅ 我想要搜索商品

❌ 我想要优化体验
✅ 我想要3秒内完成搜索
```

### 8.3 价值错误

```
❌ 我想要搜索商品
✅ 我想要搜索商品，以便找到我想要的商品

❌ 以便提升用户体验
✅ 以便快速找到想要的商品
```

### 8.4 验收标准错误

```
❌ 应该很快
✅ 3秒内返回结果

❌ 正常工作
✅ 返回搜索结果列表

❌ 用户友好
✅ 显示清晰的错误提示
```

## 9. 输出物

### 9.1 用户故事列表

| ID | 用户故事 | 优先级 | 工作量 | 状态 |
|----|---------|--------|--------|------|
| US-001 | 会员每日点券发放 | P0 | 5天 | 待开发 |
| US-002 | 点券到账通知 | P1 | 2天 | 待开发 |
| US-003 | 点券历史查询 | P2 | 3天 | 待开发 |

### 9.2 用户故事地图

```
史诗：会员权益系统

├── 用户故事1：每日点券发放
│   ├── 任务1：点券发放逻辑
│   ├── 任务2：失败补发机制
│   └── 任务3：到账通知
│
├── 用户故事2：点券使用
│   ├── 任务1：点券抵扣
│   └── 任务2：点券查询
│
└── 用户故事3：点券管理
    ├── 任务1：点券过期
    └── 任务2：点券转赠
```

## 10. 工具推荐

| 工具类型 | 推荐工具 |
|---------|---------|
| 故事管理 | Jira, Linear, Azure DevOps |
| 协作 | Miro, Mural |
| 文档 | Notion, 飞书文档 |
| 思维导图 | XMind, MindNode |
