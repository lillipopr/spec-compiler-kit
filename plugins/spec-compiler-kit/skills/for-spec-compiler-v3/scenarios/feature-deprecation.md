# 功能下线 SOP

## 核心原则

**系统复杂度 = 存活的 case 数量**

case 不在了，能力才是真的不在了。

功能下线不是简单的"注释掉代码"，而是要彻底清理。

## Step 1（AI）：反推影响

- 根据 case 反推代码引用
- 产出：《下线影响分析》

### 影响分析检查清单

- [ ] 哪些用例依赖此功能？
- [ ] 哪些接口被此功能调用？
- [ ] 哪些数据库表/字段被使用？
- [ ] 哪些配置项/开关相关？
- [ ] 是否有外部依赖？

## Step 2（人）：确认

- 确认无隐式依赖
- 确认业务不可达
- **闸口**：有隐式依赖则暂停

### 业务不可达验证

- [ ] 前端入口已移除
- [ ] API 路由已禁用
- [ ] 配置开关已关闭
- [ ] 无后台任务调用

## Step 3（AI）：清理

按以下顺序清理：

### 3.1 删除用例
```bash
# 从用例文档中删除相关 case
# 更新用例映射表
```

### 3.2 删除实现代码
```bash
# 删除 Controller/Service 层代码
# 刔回相关的工具函数
```

### 3.3 删除数据模型
```bash
# 如果表/字段不再使用，添加迁移脚本删除
# 注意：需要 DBA 审核
```

### 3.4 删除配置
```bash
# 删除相关配置项
# 删除相关开关
```

- 产出：《下线清理清单》

## Step 4（人）：验收归档

- [ ] 代码搜索无残留引用
- [ ] 测试通过
- [ ] 文档已更新
- [ ] 迁移脚本已准备

---

## 系统熵闸

**三个闸口之一，必须守**

- 功能下线时：删 case + 删代码
- 不允许：注释掉代码就完事
- 不允许：留"以后可能用到"的代码

系统熵增 = 未删除的死代码累积
