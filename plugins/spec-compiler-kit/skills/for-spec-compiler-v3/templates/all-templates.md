# 文档模板汇总

本文档提供规格编译器 4.0 各阶段的文档模板。

> **3.0 核心变化**：
> - Phase 1：实体抽取遵循 DDD 原则（唯一 ID + 生命周期 + 状态转移）
> - Phase 1：行为分为用户行为和系统行为
> - Phase 4：端到端接口设计完整化（入参/返回值/用例/约束/状态转移/错误处理/具体逻辑）

---

## 模板索引

| Phase | 模板名称 | 性质 | 链接 |
|-------|---------|------|------|
| Phase 1 | 问题建模文档模板 | 跨端唯一 | [本文档](#问题建模文档模板) |
| Phase 2 | 可执行约束文档模板 | 跨端一致 | [本文档](#可执行约束文档模板) |
| Phase 3 | 用例文档模板 | 跨端一致 | [本文档](#用例文档模板) |
| Phase 4 | 端到端接口设计模板 | 串联各端 | [e2e-interface-template.md](e2e-interface-template.md) |

---

## 问题建模文档模板

> **3.0 升级**：实体抽取遵循 DDD 原则，行为分为用户行为和系统行为。

```markdown
# {功能名称} - 问题建模文档

> **跨端唯一真理**：本文档定义的实体、状态、不变量适用于所有端（iOS/后端/前端）。
> 各端实现时必须遵守这些约束，不得自行添加或修改业务逻辑。

## 1. 核心实体列表（DDD 原则）

| 实体名称 | 唯一标识 | 生命周期 | 状态 | 聚合关系 |
|---------|---------|---------|------|---------|
| {实体1} | {id字段} | {创建→...→终结} | {状态列表} | {聚合根/属于XX} |
| {实体2} | {id字段} | {创建→...→终结} | {状态列表} | {聚合根/属于XX} |

### 值对象列表

| 值对象名称 | 所属实体 | 说明 |
|-----------|---------|------|
| {值对象1} | {实体} | {说明} |

## 2. 状态定义表

### {实体1}状态

| 状态码 | 状态名称 | 含义 | 可转移状态 |
|-------|---------|------|-----------|
| S0 | {状态名} | {含义} | S1, S9 |
| S1 | {状态名} | {含义} | S2 |

## 3. 行为列表

### 用户行为（应用层意图）

| 行为名称 | 触发方 | 描述 | 影响的实体 |
|---------|--------|------|-----------|
| {行为1} | 用户 | {描述} | {实体} |
| {行为2} | 外部系统 | {描述} | {实体} |

### 系统行为（领域层事实）

| 行为名称 | 触发方式 | 描述 | 影响的实体 |
|---------|---------|------|-----------|
| {行为1} | 定时任务 | {描述} | {实体} |
| {行为2} | 事件监听 | {描述} | {实体} |

## 4. 不变量清单

### 结构约束
- **INV-01**：{约束描述}
- **INV-02**：{约束描述}

### 业务约束
- **INV-03**：{约束描述}
- **INV-04**：{约束描述}

### 版本约束
- **INV-05**：{约束描述}

## 5. 状态转移表

| 当前状态 | 触发行为 | 行为类型 | 目标状态 | 约束条件 |
|---------|---------|---------|---------|---------|
| S0 | {行为} | 用户/系统 | S1 | {条件} |
| S1 | {行为} | 用户/系统 | S2 | {条件} |

## 6. 禁止态说明

- **禁止态-1**：{描述}
- **禁止态-2**：{描述}

## 7. 跨端一致性声明

本文档适用于以下所有端：
- [ ] 后端（Java DDD）
- [ ] iOS（SwiftUI MVVM）
- [ ] 前端（Vue 3）
- [ ] 小程序

各端实现时必须：
1. 遵守本文档定义的所有不变量
2. 不得自行添加业务逻辑
3. 状态转移必须与本文档一致
```

---

## 可执行约束文档模板

```markdown
# {功能名称} - 可执行约束文档

> **跨端一致性**：本文档的约束适用于所有端。
> 各端实现时将伪代码翻译为对应语言（Java/Swift/TypeScript）。

## 1. 约束清单

### INV-01: {约束名称}

**约束描述**：{描述}

**伪代码**：
```
FUNCTION validate_{name}({params}) -> bool
    ASSERT {条件}
    ON_VIOLATION: THROW "INV-01: {错误信息}"
    RETURN true
END FUNCTION
```

**各端实现位置**：
| 端 | 层级 | 文件 | 方法 |
|----|------|------|------|
| 后端 | Domain | {Xxx}Domain.java | validate{Name}() |
| iOS | Service | {Xxx}Service.swift | validate{Name}() |
| 前端 | Service | {xxx}Service.ts | validate{Name}() |

---

## 2. 状态转移表（伪代码）

```
ALLOWED_TRANSITIONS = {
    # (当前状态, 事件) -> (下一状态, [约束列表])
    ("S0", "event_1"): ("S1", [INV-01, INV-02]),
    ("S1", "event_2"): ("S2", [INV-03]),
}
```

---

## 3. 禁止态（伪代码）

```
PROHIBITED_TRANSITIONS = {
    # (当前状态, 目标状态) -> "禁止原因"
    ("S2", "S0"): "{禁止原因}",
}
```

---

## 4. 约束优先级

| 优先级 | 不变量 | 原因 |
|-------|--------|------|
| P0 | INV-{N} ({名称}) | {原因} |
| P1 | INV-{N} ({名称}) | {原因} |

---

## 5. 审核检查点

- [ ] 所有约束使用伪代码定义
- [ ] 所有约束标注各端实现位置
- [ ] 无平台特定语法
```

---

## 用例文档模板

```markdown
# {功能名称} - 用例文档

> **跨端一致性**：本文档的用例适用于所有端。
> 各端测试时使用相同的用例，确保行为一致。

## 1. 正向用例（Happy Path）

### Case-01：{用例名称}

**前置条件（Given）**：
- 系统状态：{描述}
- 数据状态：{描述}

**触发行为（When）**：
- {操作描述}

**预期结果（Then）**：
- 状态变化：{状态A} → {状态B}
- 输出结果：{预期返回}
- 副作用：{数据变化}

**约束/不变量**：
- INV-XX：{不变量描述}

**各端验证方式**：
| 端 | 验证方式 | 测试文件 |
|----|---------|---------|
| 后端 | 单元测试 | {Xxx}Test.java |
| iOS | 单元测试 | {Xxx}Tests.swift |
| 前端 | 单元测试 | {xxx}.test.ts |

---

## 2. Bad Case / 异常用例

### Case-02：{用例名称}（禁止态）

**前置条件（Given）**：
- {异常条件描述}

**触发行为（When）**：
- {非法操作描述}

**预期结果（Then）**：
- 状态变化：无（操作被拒绝）
- 输出结果：抛出异常 "{错误信息}"

**约束/不变量**：
- INV-XX：{不变量描述}
- 禁止态-X：{禁止态描述}

---

## 3. 用例映射表

| 用例编号 | 用例名称 | 类型 | 覆盖不变量 | 覆盖状态转移 | 优先级 |
|---------|---------|------|-----------|-------------|--------|
| Case-01 | {名称} | 正向 | INV-XX | S0→S1 | P0 |
| Case-02 | {名称} | Bad | INV-XX | 禁止态 | P1 |

---

## 4. 审核检查点

- [ ] 每个不变量至少有一个用例覆盖
- [ ] 每个禁止态至少有一个 Bad Case
- [ ] 各端验证方式已明确
```

---

## 审核检查点（通用）

- [ ] 每个接口可追溯到用例
- [ ] 每个实体承载明确的不变量
- [ ] 分层职责清晰分离
- [ ] 文件名、类名、方法名明确无歧义
- [ ] 外部依赖明确列出
- [ ] **跨端一致性检查通过**
