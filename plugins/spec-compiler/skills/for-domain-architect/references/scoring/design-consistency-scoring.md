# 设计一致性评分标准

> **满分**：100 分
> **及格分**：60 分
> **优秀线**：80 分
> **评分对象**：整体设计文档
> **评分目的**：验证各章节设计的一致性和完整性

---

## 评分维度

| 维度 | 权重 | 评分要点 |
|------|------|---------|
| 章节间一致性 | 22 分 | 各章节设计的一致性、无冲突 |
| 设计完整性 | 25 分 | 设计覆盖所有必要内容 |
| 原则遵循度 | 33 分 | 对原则文件的遵循程度 |
| 检查清单对应 | 20 分 | 与检查清单的对应关系 |

---

## 一、章节间一致性（22 分）

### 1.1 限界上下文与聚合一致性（8 分）

**满分**：8 分

**评分标准**：
- 优秀（90-100分）：限界上下文与聚合设计完全一致
- 良好（80-89分）：90%以上一致
- 及格（60-79分）：70%以上一致
- 不及格（<60分）：低于70%一致

**检查项**：
- [ ] 每个限界上下文都有对应的聚合设计（3分）
- [ ] 上下文边界与聚合边界一致（3分）
- [ ] 上下文间关系与聚合间引用一致（2分）

**验证方法**：
1. 上下文映射图中的每个上下文是否都在聚合设计中体现
2. 聚合是否只在其所属上下文内
3. 跨上下文的聚合引用是否只使用 ID

**扣分项**：
- 上下文无对应聚合：扣 2 分/个
- 边界不一致：扣 2 分/处
- 引用方式不一致：扣 1 分/处

---

### 1.2 聚合与领域服务一致性（7 分）

**满分**：7 分

**评分标准**：
- 优秀（90-100分）：聚合与领域服务设计完全一致
- 良好（80-89分）：90%以上一致
- 及格（60-79分）：70%以上一致
- 不及格（<60分）：低于70%一致

**检查项**：
- [ ] 领域服务涉及的聚合都在聚合设计中（3分）
- [ ] 领域服务协调的聚合根都在聚合设计中（2分）
- [ ] 领域服务不直接修改聚合状态（2分）

**验证方法**：
1. 领域服务中引用的聚合是否都在聚合列表中
2. 领域服务是否通过聚合根行为修改状态
3. 领域服务是否无状态

**扣分项**：
- 领域服务引用不存在的聚合：扣 2 分/个
- 领域服务直接修改状态：扣 2 分/处

---

### 1.3 领域服务与应用层一致性（7 分）

**满分**：7 分

**评分标准**：
- 优秀（90-100分）：领域服务与应用层设计完全一致
- 良好（80-89分）：90%以上一致
- 及格（60-79分）：70%以上一致
- 不及格（<60分）：低于70%一致

**检查项**：
- [ ] 应用层调用的领域服务都在领域服务设计中（3分）
- [ ] 应用层不重复领域服务的逻辑（2分）
- [ ] 领域服务不管理事务（2分）

**验证方法**：
1. 应用层调用的领域服务是否都在领域服务列表中
2. 应用层是否包含本应在领域服务的逻辑
3. 领域服务是否包含事务管理

**扣分项**：
- 应用层调用不存在的领域服务：扣 2 分/个
- 应用层重复领域服务逻辑：扣 2 分/处
- 领域服务管理事务：扣 2 分/处

---

## 二、设计完整性（25 分）

### 2.1 战略设计完整性（8 分）

**满分**：8 分

**评分标准**：
- 优秀（90-100分）：战略设计内容完整
- 良好（80-89分）：90%以上内容完整
- 及格（60-79分）：70%以上内容完整
- 不及格（<60分）：低于70%内容完整

**检查项**：
- [ ] 业务能力树完整（2分）
- [ ] 限界上下文划分完整（2分）
- [ ] 上下文映射图完整（2分）
- [ ] 康威定律应用说明（2分）

**扣分项**：
- 内容缺失：扣 2 分/项

---

### 2.2 战术设计完整性（10 分）

**满分**：10 分

**评分标准**：
- 优秀（90-100分）：战术设计内容完整
- 良好（80-89分）：90%以上内容完整
- 及格（60-79分）：70%以上内容完整
- 不及格（<60分）：低于70%内容完整

**检查项**：
- [ ] 聚合设计完整（4分）：聚合根、实体、值对象
- [ ] 领域服务设计完整（3分）
- [ ] 事件发布设计完整（2分）：事件定义在聚合根中
- [ ] 聚合图完整（1分）

**扣分项**：
- 内容缺失：扣 2 分/项

---

### 2.3 应用层设计完整性（7 分）

**满分**：7 分

**评分标准**：
- 优秀（90-100分）：应用层设计内容完整
- 良好（80-89分）：90%以上内容完整
- 及格（60-79分）：70%以上内容完整
- 不及格（<60分）：低于70%内容完整

**检查项**：
- [ ] 用户行为完整（2分）
- [ ] 系统行为完整（2分）
- [ ] 应用服务列表完整（2分）
- [ ] Command 和 DTO 列表完整（1分）

**扣分项**：
- 内容缺失：扣 2 分/项

---

## 三、原则遵循度（25 分）

### 3.1 限界上下文原则遵循（6 分）

**满分**：6 分

**评分标准**：
- 优秀（90-100分）：完全遵循 bounded-context.md 原则
- 良好（80-89分）：90%以上遵循
- 及格（60-79分）：70%以上遵循
- 不及格（<60分）：低于70%遵循

**检查项**：
- [ ] 业务能力分析原则（2分）：bounded-context.md 1.1-1.4
- [ ] 限界上下文划分原则（2分）：bounded-context.md 2.1-2.3
- [ ] 上下文映射原则（2分）：bounded-context.md 3.1-3.3

**扣分项**：
- 违反原则：扣 1 分/处

---

### 3.2 聚合设计原则遵循（7 分）

**满分**：7 分

**评分标准**：
- 优秀（90-100分）：完全遵循 aggregate.md 原则
- 良好（80-89分）：90%以上遵循
- 及格（60-79分）：70%以上遵循
- 不及格（<60分）：低于70%遵循

**检查项**：
- [ ] 聚合根识别原则（2分）：aggregate.md 1.1-1.3
- [ ] 聚合设计核心原则（3分）：aggregate.md 2.1-2.6
- [ ] 聚合边界确定原则（2分）：aggregate.md 3.1-3.3

**扣分项**：
- 违反原则：扣 1 分/处

---

### 3.3 领域服务原则遵循（5 分）

**满分**：5 分

**评分标准**：
- 优秀（90-100分）：完全遵循 domain-service.md 原则
- 良好（80-89分）：90%以上遵循
- 及格（60-79分）：70%以上遵循
- 不及格（<60分）：低于70%遵循

**检查项**：
- [ ] 领域服务识别原则（2分）：domain-service.md 1.1-1.3
- [ ] 领域服务设计原则（3分）：domain-service.md 2.1-2.3

**扣分项**：
- 违反原则：扣 1 分/处

---

### 3.4 应用层原则遵循（8 分）（v2.1 更新）

**满分**：8 分

**评分标准**：
- 优秀（90-100分）：完全遵循 application.md 原则
- 良好（80-89分）：90%以上遵循
- 及格（60-79分）：70%以上遵循
- 不及格（<60分）：低于70%遵循

**检查项**：
- [ ] 应用层职责原则（2分）：application.md 1.1-1.2
- [ ] 用户行为 vs 系统行为原则（2分）：application.md 2.1-2.3
- [ ] 应用服务设计原则（2分）：application.md 3.1-3.3
- [ ] 事件处理设计原则（2分）：application.md 8.1-8.5（v2.1 新增）

**扣分项**：
- 违反原则：扣 1 分/处

---

### 3.5 入口层原则遵循（7 分）

**满分**：7 分

**评分标准**：
- 优秀（90-100分）：完全遵循 starter.md 原则
- 良好（80-89分）：90%以上遵循
- 及格（60-79分）：70%以上遵循
- 不及格（<60分）：低于70%遵循

**检查项**：
- [ ] 入口层职责原则（2分）：starter.md 入口层职责
- [ ] Controller 设计原则（3分）：starter.md Controller 设计
- [ ] DTO 返回原则（2分）：starter.md DTO 返回

**扣分项**：
- 违反原则：扣 1 分/处

---

## 四、检查清单对应（20 分）

### 4.1 检查清单完整性（10 分）

**满分**：10 分

**评分标准**：
- 优秀（90-100分）：所有章节都有对应的检查清单
- 良好（80-89分）：90%以上章节有对应检查清单
- 及格（60-79分）：70%以上章节有对应检查清单
- 不及格（<60分）：低于70%章节有对应检查清单

**检查项**：
- [ ] chapter-01-checklist.md（2分）
- [ ] chapter-02-checklist.md（2分）
- [ ] chapter-03-checklist.md（2分）
- [ ] chapter-04-checklist.md（2分）
- [ ] chapter-05-checklist.md（2分）

**扣分项**：
- 检查清单缺失：扣 2 分/个

---

### 4.2 检查清单与设计对应（10 分）

**满分**：10 分

**评分标准**：
- 优秀（90-100分）：设计内容与检查清单完全对应
- 良好（80-89分）：90%以上对应
- 及格（60-79分）：70%以上对应
- 不及格（<60分）：低于70%对应

**检查项**：
- [ ] 设计内容覆盖检查清单所有核心项（5分）
- [ ] 检查清单所有核心项都有对应设计（5分）

**验证方法**：
1. 检查清单中的每个核心项是否在设计中体现
2. 设计中的每个关键点是否在检查清单中覆盖

**扣分项**：
- 设计未覆盖检查清单：扣 2 分/项
- 检查清单未覆盖设计：扣 1 分/项

---

## 快速评分表

| 检查项 | 分值 | 得分 | 备注 |
|--------|------|------|------|
| **章节间一致性** | | | |
| 上下文有对应聚合 | 3 | __ | 上下文与聚合 |
| 边界一致 | 3 | __ | 上下文与聚合 |
| 引用方式一致 | 2 | __ | 上下文与聚合 |
| 领域服务涉及的聚合 | 3 | __ | 聚合与领域服务 |
| 通过聚合根行为 | 2 | __ | 聚合与领域服务 |
| 领域服务无状态 | 2 | __ | 聚合与领域服务 |
| 应用层调用的服务 | 3 | __ | 领域服务与应用层 |
| 不重复逻辑 | 2 | __ | 领域服务与应用层 |
| 领域服务不管理事务 | 2 | __ | 领域服务与应用层 |
| **设计完整性** | | | |
| 业务能力树完整 | 2 | __ | 战略设计 |
| 上下文划分完整 | 2 | __ | 战略设计 |
| 上下文映射图完整 | 2 | __ | 战略设计 |
| 康威定律应用 | 2 | __ | 战略设计 |
| 聚合设计完整 | 4 | __ | 战术设计 |
| 领域服务设计完整 | 3 | __ | 战术设计 |
| 事件发布设计完整 | 2 | __ | 战术设计 |
| 聚合图完整 | 1 | __ | 战术设计 |
| 用户行为完整 | 2 | __ | 应用层设计 |
| 系统行为完整 | 2 | __ | 应用层设计 |
| 应用服务列表完整 | 2 | __ | 应用层设计 |
| Command和DTO列表 | 1 | __ | 应用层设计 |
| **原则遵循度** | | | |
| 业务能力分析原则 | 2 | __ | bounded-context.md |
| 上下文划分原则 | 2 | __ | bounded-context.md |
| 上下文映射原则 | 2 | __ | bounded-context.md |
| 聚合根识别原则 | 2 | __ | aggregate.md |
| 聚合设计核心原则 | 3 | __ | aggregate.md |
| 聚合边界确定原则 | 2 | __ | aggregate.md |
| 领域服务识别原则 | 2 | __ | domain-service.md |
| 领域服务设计原则 | 3 | __ | domain-service.md |
| 应用层职责原则 | 2 | __ | application.md |
| 用户行为vs系统行为 | 2 | __ | application.md |
| 应用服务设计原则 | 2 | __ | application.md |
| 事件处理设计原则 | 2 | __ | application.md（v2.1新增） |
| 入口层职责原则 | 2 | __ | starter.md |
| Controller设计原则 | 3 | __ | starter.md |
| DTO返回原则 | 2 | __ | starter.md |
| **检查清单对应** | | | |
| chapter-01-checklist | 2 | __ | 检查清单完整性 |
| chapter-02-checklist | 2 | __ | 检查清单完整性 |
| chapter-03-checklist | 2 | __ | 检查清单完整性 |
| chapter-04-checklist | 2 | __ | 检查清单完整性 |
| chapter-05-checklist | 2 | __ | 检查清单完整性 |
| 设计覆盖检查清单 | 5 | __ | 检查清单与设计对应 |
| 检查清单覆盖设计 | 5 | __ | 检查清单与设计对应 |
| **总计** | 100 | __ | |

---

## 及格标准

- **章节及格线**：60 分
- **优秀线**：80 分
- **核心项必须通过**：
  - 章节间一致性 ≥ 20 分
  - 设计完整性 ≥ 18 分
  - 原则遵循度 ≥ 18 分
  - 检查清单对应 ≥ 14 分

---

## 一致性验证清单

### 验证步骤

1. **限界上下文 → 聚合**
   - [ ] 上下文映射图中的每个上下文是否都在聚合设计中体现
   - [ ] 聚合是否只在其所属上下文内
   - [ ] 跨上下文的聚合引用是否只使用 ID

2. **聚合 → 领域服务**
   - [ ] 领域服务中引用的聚合是否都在聚合列表中
   - [ ] 领域服务是否通过聚合根行为修改状态
   - [ ] 领域服务是否无状态

3. **领域服务 → 应用层**
   - [ ] 应用层调用的领域服务是否都在领域服务列表中
   - [ ] 应用层是否包含本应在领域服务的逻辑
   - [ ] 领域服务是否包含事务管理

4. **应用层 → 入口层**
   - [ ] 入口层调用的应用服务是否都在应用服务列表中
   - [ ] 入口层是否包含业务逻辑
   - [ ] 入口层是否使用 DTO

---

## 评分示例

### 优秀示例（97 分）

**场景**：会员订阅系统整体设计

**评分过程**：
1. 章节间一致性：22/22 分
   - 限界上下文与聚合：8/8 分（完全一致）
   - 聚合与领域服务：7/7 分（完全一致）
   - 领域服务与应用层：7/7 分（完全一致）

2. 设计完整性：24/25 分
   - 战略设计完整性：8/8 分（内容完整）
   - 战术设计完整性：10/10 分（内容完整）
   - 应用层设计完整性：6/7 分（基本完整，扣1分因为缺少一个系统行为的说明）

3. 原则遵循度：32/33 分
   - 限界上下文原则：6/6 分（完全遵循）
   - 聚合设计原则：7/7 分（完全遵循）
   - 领域服务原则：5/5 分（完全遵循）
   - 应用层原则：7/8 分（基本遵循，扣1分因为有一个事件监听器设计略不规范）
   - 入口层原则：7/7 分（完全遵循）

4. 检查清单对应：20/20 分
   - 检查清单完整性：10/10 分（所有章节都有对应检查清单）
   - 检查清单与设计对应：10/10 分（完全对应）

**总分**：97/100 分（优秀）

**改进建议**：
1. 补充系统行为说明
2. 优化事件监听器设计

---

## 原则追溯

本评分标准基于以下原则：
- bounded-context.md：限界上下文相关原则
- aggregate.md：聚合相关原则
- domain-service.md：领域服务相关原则
- application.md：应用层相关原则（含事件处理设计，v2.1 新增）
- starter.md：入口层相关原则

---

## 检查清单对应

本评分标准与所有章节检查清单对应：
- chapter-01-checklist.md → 第一章：限界上下文设计
- chapter-02-checklist.md → 第二章：聚合设计
- chapter-03-checklist.md → 第三章：领域服务设计
- chapter-04-checklist.md → 第四章：应用层设计
- chapter-05-checklist.md → 第五章：入口层设计
