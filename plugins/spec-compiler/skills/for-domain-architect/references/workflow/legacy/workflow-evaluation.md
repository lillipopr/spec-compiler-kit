# 评估流程详解

> **目标**：对领域设计文档进行全面评分和质量评估

---

## 流程图

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          评估流程                                        │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  输入：领域设计文档                                                       │
│    ↓                                                                     │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │ Step 1：章节评分                                                │    │
│  │   - 第一章：限界上下文设计（权重 15%）                            │    │
│  │   - 第二章：聚合设计（权重 25%）                                 │    │
│  │   - 第三章：领域服务设计（权重 10%）                             │    │
│  │   - 第四章：应用层设计（权重 15%）                               │    │
│  │   - 第五章：入口层设计（权重 10%）                               │    │
│  │   - 每章使用对应评分标准                                         │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│    ↓                                                                     │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │ Step 2：设计一致性评分（权重 15%）                                │    │
│  │   - 命名一致性                                                   │    │
│  │   - 引用正确性                                                   │    │
│  │   - 覆盖完整性                                                   │    │
│  │   - 设计无矛盾                                                   │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│    ↓                                                                     │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │ Step 3：综合评分                                                │    │
│  │   总分 = Σ(章节分数 × 权重) + 一致性分数 × 权重                     │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│    ↓                                                                     │
│  总分 ≥ 90?                                                              │
│  ├─ 是 → 生成评分报告，通过评估                                          │
│  └─ 否 → 生成问题报告，需修改                                            │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## Step 1：章节评分

### 评分标准文件

| 章节 | 评分标准文件 | 满分 | 及格线 | 权重 |
|------|-------------|------|--------|------|
| 第一章 | scoring/chapter-01-scoring.md | 100 | 60 | 15% |
| 第二章 | scoring/chapter-02-scoring.md | 100 | 60 | 25% |
| 第三章 | scoring/chapter-03-scoring.md | 100 | 60 | 10% |
| 第四章 | scoring/chapter-04-scoring.md | 100 | 60 | 15% |
| 第五章 | scoring/chapter-05-scoring.md | 100 | 60 | 10% |

### 第一章：限界上下文设计评分

**评分维度**：

| 维度 | 权重 | 评分要点 |
|------|------|---------|
| 业务能力分析 | 40% | - 业务能力树完整（20分）<br>- 能力分级合理（10分）<br>- 与团队对齐清晰（10分） |
| 限界上下文划分 | 35% | - 上下文识别准确（15分）<br>- 上下文类型正确（10分）<br>- 边界定义清晰（10分） |
| 上下文映射 | 25% | - 关系图清晰（10分）<br>- 集成模式合理（10分）<br>- 防腐层设计完善（5分） |

**评分方法**：
1. 读取第一章内容
2. 逐项检查评分要点
3. 计算各维度得分
4. 加权计算总分

**示例**：
```
业务能力分析：38/40 分
- 业务能力树完整：18/20 分（缺少一个能力）
- 能力分级合理：10/10 分
- 与团队对齐清晰：10/10 分

限界上下文划分：30/35 分
- 上下文识别准确：13/15 分
- 上下文类型正确：9/10 分
- 边界定义清晰：8/10 分

上下文映射：20/25 分
- 关系图清晰：8/10 分
- 集成模式合理：7/10 分
- 防腐层设计完善：5/5 分

第一章总分：88/100 分 × 15% = 13.2 分
```

### 第二章：聚合设计评分

**评分维度**：

| 维度 | 权重 | 评分要点 |
|------|------|---------|
| 聚合识别 | 30% | - 聚合根识别正确（15分）<br>- 聚合边界清晰（15分） |
| 聚合根设计 | 40% | - 属性完整（10分）<br>- 状态定义（10分）<br>- 行为设计（15分）<br>- 约束定义（5分） |
| 实体值对象 | 20% | - 实体识别正确（10分）<br>- 值对象设计合理（10分） |
| 设计完整性 | 10% | - 无遗漏（5分）<br>- 无矛盾（5分） |

**评分方法**：
1. 读取第二章内容
2. 检查每个聚合的设计
3. 逐项评分
4. 加权计算总分

### 第三章：领域服务设计评分

**评分维度**：

| 维度 | 权重 | 评分要点 |
|------|------|---------|
| 服务识别 | 40% | - 识别准确（20分）<br>- 服务命名规范（10分）<br>- 职责清晰（10分） |
| 服务设计 | 40% | - 方法签名正确（10分）<br>- 约束定义完整（20分）<br>- 用例设计充分（10分） |
| 设计完整性 | 20% | - 无遗漏（10分）<br>- 无冗余（10分） |

### 第四章：应用层设计评分

**评分维度**：

| 维度 | 权重 | 评分要点 |
|------|------|---------|
| 应用服务 | 30% | - 服务识别完整（10分）<br>- 服务命名规范（10分）<br>- 职责清晰（10分） |
| 行为设计 | 50% | - 用户行为完整（25分）<br>- 系统行为完整（25分） |
| 用例设计 | 20% | - 用例覆盖充分（10分）<br>- 约束定义完整（10分） |

### 第五章：入口层设计评分

**评分维度**：

| 维度 | 权重 | 评分要点 |
|------|------|---------|
| Controller 设计 | 40% | - 接口路径规范（15分）<br>- 参数命名规范（15分）<br>- 使用对象类型（10分） |
| MQ 设计 | 30% | - 消费者设计合理（15分）<br>- 幂等性保证（15分） |
| Task 设计 | 30% | - 定时任务设计合理（15分）<br>- 分布式锁（15分） |

---

## Step 2：设计一致性评分

### 评分维度

| 维度 | 满分 | 评分要点 |
|------|------|---------|
| 命名一致性 | 25 | - 聚合命名一致（5分）<br>- 服务命名一致（5分）<br>- 事件命名一致（5分）<br>- 参数命名一致（5分）<br>- 无驼峰命名（5分） |
| 引用正确性 | 25 | - 章节间引用正确（10分）<br>- 表格引用正确（10分）<br>- 代码示例引用正确（5分） |
| 覆盖完整性 | 25 | - PRD 需求全覆盖（15分）<br>- 功能点全覆盖（10分） |
| 设计无矛盾 | 25 | - 设计决策无冲突（10分）<br>- 约束无冲突（10分）<br>- 用例无冲突（5分） |

### 评分方法

**命名一致性检查**：

```typescript
// 检查命名是否符合规范
const namingRules = {
  aggregate: /^[A-Z][a-zA-Z0-9]*$/,           // 聚合名：大写开头
  domain: /^[A-Z][a-zA-Z0-9]*Domain$/, // 领域服务：聚合名 + Domain
  application: /^[A-Z][a-zA-Z0-9]*Application$/, // 应用服务：聚合名 + Application
  domainEvent: /^[A-Z][a-zA-Z0-9]*ActivatedEvent$/, // 领域事件：聚合名 + 动词 + Event
  param: /^[A-Z][a-zA-Z0-9]*Param$/           // 参数：动作 + 聚合名 + Param
}
```

**引用正确性检查**：

1. 提取所有章节引用
2. 验证引用的章节是否存在
3. 验证引用的表格是否存在
4. 验证引用的代码示例是否存在

**覆盖完整性检查**：

1. 提取 PRD 中的所有需求
2. 提取设计文档中的所有功能点
3. 对比检查是否有遗漏

**设计无矛盾检查**：

1. 提取所有设计决策
2. 检查是否有冲突
3. 检查约束是否有矛盾
4. 检查用例是否有矛盾

---

## Step 3：综合评分

### 评分公式

```
总分 = Σ(章节分数 × 权重) + 一致性分数 × 权重

总分 = 第一章分数 × 15% +
       第二章分数 × 25% +
       第三章分数 × 10% +
       第四章分数 × 15% +
       第五章分数 × 10% +
       一致性分数 × 25%
```

### 及格标准

| 标准 | 分数 | 处理 |
|------|------|------|
| **优秀** | ≥90 分 | 通过评估，可交付 |
| **良好** | 80-89 分 | 基本通过，建议微调 |
| **及格** | 60-79 分 | 需修改部分内容 |
| **不及格** | <60 分 | 需大量修改 |

### 评分等级

| 等级 | 分数范围 | 说明 |
|------|---------|------|
| A | 90-100 | 优秀，可直接交付 |
| B | 80-89 | 良好，建议微调后交付 |
| C | 70-79 | 及格，需修改后交付 |
| D | 60-69 | 勉强及格，需重点修改 |
| E | <60 | 不及格，需重新设计 |

---

## 评分报告

### 报告格式

```markdown
# 领域设计文档评分报告

## 总分：XX/100

### 评分等级：{A/B/C/D/E}

### 评分结论
- [ ] 总分 ≥90 分，通过评估
- [ ] 总分 80-89 分，建议微调
- [ ] 总分 60-79 分，需修改
- [ ] 总分 <60 分，需重新设计

---

## 章节评分

### 第一章：限界上下文设计

**得分：XX/100 × 15% = XX.X**

| 维度 | 得分 | 满分 | 问题 |
|------|------|------|------|
| 业务能力分析 | XX | 40 | {问题列表} |
| 限界上下文划分 | XX | 35 | {问题列表} |
| 上下文映射 | XX | 25 | {问题列表} |

**评价**：{通过/需改进}

### 第二章：聚合设计

**得分：XX/100 × 25% = XX.X**

| 维度 | 得分 | 满分 | 问题 |
|------|------|------|------|
| 聚合识别 | XX | 30 | {问题列表} |
| 聚合根设计 | XX | 40 | {问题列表} |
| 实体值对象 | XX | 20 | {问题列表} |
| 设计完整性 | XX | 10 | {问题列表} |

**评价**：{通过/需改进}

### 第三章：领域服务设计

**得分：XX/100 × 10% = XX.X**

{同上格式}

### 第四章：应用层设计

**得分：XX/100 × 15% = XX.X**

{同上格式}

### 第五章：入口层设计

**得分：XX/100 × 10% = XX.X**

{同上格式}

---

## 设计一致性评分

**得分：XX/100 × 25% = XX.X**

| 维度 | 得分 | 满分 | 问题 |
|------|------|------|------|
| 命名一致性 | XX | 25 | {问题列表} |
| 引用正确性 | XX | 25 | {问题列表} |
| 覆盖完整性 | XX | 25 | {问题列表} |
| 设计无矛盾 | XX | 25 | {问题列表} |

**评价**：{通过/需改进}

---

## 综合评分

| 维度 | 原始分 | 权重 | 加权分 |
|------|-------|------|--------|
| 第一章：限界上下文 | XX | 15% | XX.X |
| 第二章：聚合设计 | XX | 25% | XX.X |
| 第三章：领域服务 | XX | 10% | XX.X |
| 第四章：应用层 | XX | 15% | XX.X |
| 第五章：入口层 | XX | 10% | XX.X |
| 设计一致性 | XX | 25% | XX.X |
| **总分** | - | **100%** | **XX.X** |

---

## 问题清单

### 高优先级问题（影响总分 ≥5 分）

| 问题ID | 章节 | 问题描述 | 影响 | 优先级 |
|-------|------|---------|------|--------|
| P-001 | 第X章 | {问题描述} | -5分 | P0 |

### 中优先级问题（影响总分 2-4 分）

{同上格式}

### 低优先级问题（影响总分 <2 分）

{同上格式}

---

## 修改建议

### 需修改的章节

以下章节得分 <80 分，建议修改：

1. **第{X}章：{章节名称}**（XX分）
   - 主要问题：{问题列表}
   - 修改建议：{修改建议}

### 需优化的内容

以下内容可进一步优化：

1. **{章节名称}**
   - 优化点：{优化点}
   - 优化建议：{优化建议}

---

## 附录：评分细则

### 第一章评分细则

{具体评分细则}

### 第二章评分细则

{具体评分细则}

...（其他章节）
```

---

## 问题报告

### 报告格式

当总分 <90 分时，生成问题报告：

```markdown
# 领域设计文档问题报告

## 总分：XX/100（需修改）

## 问题概述

当前文档总分 {XX} 分，未达到 90 分的及格标准，需要进行修改。

---

## 需修改章节

### 第{X}章：{章节名称}（当前得分：XX）

**主要问题**：
1. {问题1}
2. {问题2}
3. {问题3}

**修改建议**：
1. {修改建议1}
2. {修改建议2}

**预期提升**：
- 修改后预计得分：XX 分
- 预计总分提升：XX 分

---

## 修改优先级

### P0：必须修改（影响总分 ≥10 分）

{问题列表}

### P1：强烈建议修改（影响总分 5-9 分）

{问题列表}

### P2：建议修改（影响总分 2-4 分）

{问题列表}

### P3：可选修改（影响总分 <2 分）

{问题列表}

---

## 修改路线图

### 第一轮修改（目标：总分 ≥80）

修改章节：
- [ ] 第{X}章
- [ ] 第{Y}章

预期结果：
- 总分从 {XX} 提升到 ≥80

### 第二轮修改（目标：总分 ≥90）

修改章节：
- [ ] 第{Z}章

预期结果：
- 总分从 ≥80 提升到 ≥90

---

## 支持文档

相关评分标准：
- [第一章评分标准](scoring/chapter-01-scoring.md)
- [第二章评分标准](scoring/chapter-02-scoring.md)
- [第三章评分标准](scoring/chapter-03-scoring.md)
- [第四章评分标准](scoring/chapter-04-scoring.md)
- [第五章评分标准](scoring/chapter-05-scoring.md)
```

---

## 支持文档

### 评分标准
- [第一章评分标准](../scoring/chapter-01-scoring.md)
- [第二章评分标准](../scoring/chapter-02-scoring.md)
- [第三章评分标准](../scoring/chapter-03-scoring.md)
- [第四章评分标准](../scoring/chapter-04-scoring.md)
- [第五章评分标准](../scoring/chapter-05-scoring.md)
- [设计一致性评分标准](../scoring/design-consistency-scoring.md)

### 检查清单
- [第一章检查清单](../checklists/chapter-01-checklist.md)
- [第二章检查清单](../checklists/chapter-02-checklist.md)
- [第三章检查清单](../checklists/chapter-03-checklist.md)
- [第四章检查清单](../checklists/chapter-04-checklist.md)
- [第五章检查清单](../checklists/chapter-05-checklist.md)
- [最终审查清单](../checklists/final-review-checklist.md)
