# 人工 Review 流程

> **核心理念**：Human-in-Loop - 每章完成后人工 Review，及时发现问题

---

## 为什么需要人工 Review

### 问题分析

| 问题 | 说明 | 影响 |
|------|------|------|
| **AI 生成有盲点** | 可能理解错误或遗漏 | 质量问题 |
| **用户预期不同** | AI 理解可能不符合用户意图 | 需要修改 |
| **发现太晚成本高** | 最后才发现问题 | 大量修改 |
| **信任度低** | 用户看不到中间结果 | 不信任 |

### 人工 Review 的优势

| 优势 | 说明 | 效果 |
|------|------|------|
| **及时纠错** | 每章完成后立即发现 | 成本低 |
| **意图对齐** | 确保符合用户预期 | 满意度高 |
| **逐步建立信任** | 看到每个章节的质量 | 信任度高 |
| **反馈闭环** | 及时调整后续生成 | 整体质量提升 |

---

## Review 流程

### 完整流程

```
┌─────────────────────────────────────────┐
│ 章节完成（PDCA #3 通过）                 │
└─────────────────────────────────────────┘
  ↓
┌─────────────────────────────────────────┐
│ Step 1：系统提示 Review                  │
│   - 展示章节文件路径                    │
│   - 展示评分报告                        │
│   - 展示问题记录                        │
│   - 提供操作选项                        │
└─────────────────────────────────────────┘
  ↓
┌─────────────────────────────────────────┐
│ Step 2：用户审核                        │
│   - 打开章节文件                        │
│   - 查看评分报告                        │
│   - 查看问题记录                        │
│   - 分析是否需要修改                    │
└─────────────────────────────────────────┘
  ↓
┌─────────────────────────────────────────┐
│ Step 3：用户反馈                        │
│   选项 A："继续" → 进入下一章            │
│   选项 B：修改意见 → 执行修改           │
│   选项 C："查看详情" → 显示更多信息     │
└─────────────────────────────────────────┘
  ↓
┌─────────────────────────────────────────┐
│ Step 4：系统处理反馈                    │
│   A: 标记 Review 通过，继续下一章       │
│   B: 执行修改，重新 Review              │
│   C: 显示详细信息                       │
└─────────────────────────────────────────┘
```

---

## Step 1：系统提示 Review

### 提示模板

```markdown
==================================================
📋 第 {N} 章已完成，等待您的 Review
==================================================

## 章节信息
- 章节：{章节名称}
- 文件：{章节文件路径}
- 评分：{评分}/100

## 快速链接
1. 查看章节内容：`cat {章节文件路径}`
2. 查看评分报告：`cat {评分报告路径}`
3. 查看问题记录：`cat {问题记录路径}`

## 操作选项
- 输入 "继续" → 确认无误，进入下一章
- 输入 "修改：{修改意见}" → 提出修改要求
- 输入 "查看详情" → 显示更多统计信息
- 输入 "重新生成" → 重新生成本章

==================================================
请输入您的选择：
```

### 进度上下文

```markdown
## 当前进度

### 已完成
✅ 第一章：限界上下文设计（Review 通过）
✅ 第二章：聚合设计（Review 通过）

### 当前 Review
🔄 第三章：领域服务设计（等待 Review）

### 待生成
⏳ 第四章：应用层设计
⏳ 第五章：入口层设计
⏳ 文档组装
```

---

## Step 2：用户审核

### 审核检查清单

```markdown
## 审核检查清单

### 内容完整性
- [ ] 章节内容是否完整？
- [ ] 是否有明显的遗漏？
- [ ] 是否有重复或冗余内容？

### 设计合理性
- [ ] 设计是否符合业务需求？
- [ ] 设计是否符合 DDD 原则？
- [ ] 设计是否可实施？

### 表述清晰性
- [ ] 术语使用是否准确？
- [ ] 逻辑是否清晰？
- [ ] 是否有歧义表达？

### 与其他章节的一致性
- [ ] 与前序章节是否一致？
- [ ] 引用关系是否正确？
```

### 常见问题类型

| 问题类型 | 说明 | 示例 |
|---------|------|------|
| **遗漏** | 缺少必要内容 | 缺少某个聚合设计 |
| **错误** | 设计不正确 | 聚合边界划分错误 |
| **不一致** | 与其他章节冲突 | 实体命名不一致 |
| **不准确** | 表述有歧义 | 接口描述不清晰 |
| **过度设计** | 设计过于复杂 | 不必要的领域服务 |
| **不足设计** | 设计不够完善 | 缺少必要的用例 |

---

## Step 3：用户反馈

### 选项 A："继续"

```markdown
> 继续

==================================================
✅ Review 通过！
==================================================
第 {N} 章 Review 已通过，即将进入下一章生成...

下一章：{下一章名称}
```

### 选项 B：修改意见

```markdown
> 修改：聚合 Membership 的边界定义需要调整，应该包含...

==================================================
📝 收到修改意见
==================================================
修改内容：{用户修改意见}

正在执行修改...
```

**修改意见格式建议**：
- 具体指出位置：`在 "XX 聚合设计" 部分`
- 描述问题：`聚合边界应该包含...`
- 说明原因：`因为业务需求是...`

### 选项 C："查看详情"

```markdown
> 查看详情

==================================================
📊 章节详情统计
==================================================

## 内容统计
- 总段落数：{数量}
- 总表格数：{数量}
- 总代码块数：{数量}

## 质量统计
- Principles 问题：{数量}（已修复）
- Checklist 问题：{数量}（已修复）
- 评分：{评分}/100

## 问题记录摘要
- 问题 1：{摘要}
- 问题 2：{摘要}
...

## 前序章节依赖
- 依赖：{前序章节}
- 依赖内容：{关键摘要}

==================================================
输入 "返回" 回到主菜单
```

---

## Step 4：系统处理反馈

### A：标记 Review 通过

```
1. 更新任务状态：{章节任务} → completed
2. 记录 Review 通过时间
3. 更新 Roadmap 进度
4. 开始下一章生成
```

### B：执行修改

```
1. 解析修改意见
2. 定位修改位置
3. 执行修改（保留其他内容不变）
4. 重新评分
5. 提示用户重新 Review
```

**修改模板**：
```markdown
==================================================
📝 修改已完成
==================================================
修改位置：{位置}
修改内容：{内容摘要}

重新评分：{新评分}/100

请重新 Review：
- 输入 "继续" → 确认修改，进入下一章
- 输入 "继续修改：{意见}" → 进一步修改
==================================================
```

### C：显示详细信息

显示 `Step 2` 中的详情统计内容。

---

## Review 状态管理

### 状态定义

| 状态 | 说明 | 图标 |
|------|------|------|
| **等待 Review** | 章节已完成，等待用户审核 | ⏸️ |
| **Review 通过** | 用户确认无误 | ✅ |
| **需要修改** | 用户提出修改意见 | 📝 |
| **修改中** | 正在执行修改 | 🔄 |
| **修改完成** | 修改完成，等待重新 Review | 🔍 |

### 状态转换

```
等待 Review
  ↓ "继续"
Review 通过

等待 Review
  ↓ 修改意见
需要修改
  ↓ 执行修改
修改中
  ↓ 修改完成
修改完成
  ↓ 重新 Review
(回到 等待 Review)
```

---

## 修改处理流程

### 修改类型

| 修改类型 | 处理方式 | 示例 |
|---------|---------|------|
| **内容补充** | 在指定位置添加内容 | 补充缺少的聚合设计 |
| **内容修正** | 修改错误的内容 | 修正聚合边界定义 |
| **内容删除** | 删除冗余内容 | 删除不必要的领域服务 |
| **结构调整** | 调整章节结构 | 调整聚合顺序 |
| **表述优化** | 优化文字表述 | 使描述更清晰 |

### 修改执行

```markdown
## 修改执行步骤

1. 分析修改意见
   - 识别修改类型
   - 定位修改位置
   - 理解修改意图

2. 执行修改
   - 读取当前内容
   - 应用修改
   - 保持其他内容不变

3. 验证修改
   - 检查语法正确
   - 检查逻辑一致
   - 重新评分

4. 保存结果
   - 更新章节文件
   - 更新评分报告
   - 记录修改历史
```

### 修改历史

```markdown
## 修改历史

### 修改 #1
- **时间**：{时间戳}
- **意见**：{修改意见}
- **修改位置**：{位置}
- **修改类型**：{类型}
- **修改前评分**：{评分}
- **修改后评分**：{评分}
```

---

## 特殊场景处理

### 场景 1：连续修改失败

```
如果同一章节连续 3 次修改后评分仍下降：
1. 提示用户考虑接受当前版本
2. 或者建议跳过当前章节，稍后人工修改
```

### 场景 2：用户放弃当前版本

```
用户输入 "重新生成"：
1. 清除当前章节所有文件
2. 重新执行 3×PDCA 循环
3. 重新 Review
```

### 场景 3：跳过 Review

```
用户输入 "跳过"：
⚠️ 确认：跳过 Review 将直接进入下一章
- 输入 "确认跳过" → 继续
- 输入 "取消" → 回到 Review

注意：跳过 Review 可能导致后续需要大量修改
```

---

## 最佳实践

### DO ✅

- ✅ 每章完成后主动提示 Review
- ✅ 提供清晰的文件路径和操作指引
- ✅ 记录所有修改历史
- ✅ 修改后重新评分
- ✅ 保持修改的原子性

### DON'T ❌

- ❌ 自动跳过 Review
- ❌ 不提供文件路径
- ❌ 修改后不重新验证
- ❌ 修改影响其他内容
- ❌ 不记录修改历史

---

## 示例对话

```markdown
==================================================
📋 第三章已完成，等待您的 Review
==================================================

## 章节信息
- 章节：领域服务设计
- 文件：output/chapter-03.md
- 评分：78/100

## 快速链接
1. 查看章节内容：`cat output/chapter-03.md`
2. 查看评分报告：`cat output/chapter-03-score.md`
3. 查看问题记录：`cat output/chapter-03-issues-*.md`

## 操作选项
- 输入 "继续" → 确认无误，进入下一章
- 输入 "修改：{修改意见}" → 提出修改要求
- 输入 "查看详情" → 显示更多统计信息

==================================================
请输入您的选择：
```

```
> 修改：在会员等级升级服务中，应该增加对升级条件的验证逻辑

==================================================
📝 收到修改意见
==================================================
修改内容：在会员等级升级服务中，应该增加对升级条件的验证逻辑

正在执行修改...
✅ 修改完成

修改位置：3.2.1 会员等级升级服务
修改内容：添加了升级条件验证逻辑（validateUpgradeCriteria）

重新评分：82/100

请重新 Review：
- 输入 "继续" → 确认修改，进入下一章
- 输入 "继续修改：{意见}" → 进一步修改
==================================================
```

```
> 继续

==================================================
✅ Review 通过！
==================================================
第三章 Review 已通过，即将进入下一章生成...

下一章：第四章 - 应用层设计
==================================================
```

---

## 总结

通过人工 Review 流程：

1. **及时发现问题**：每章完成后立即 Review
2. **意图对齐**：确保符合用户预期
3. **逐步建立信任**：用户看到每个章节的质量
4. **反馈闭环**：及时调整后续生成

人工 Review 是保证最终质量的关键环节，也是 AI 与用户协作的重要桥梁。
