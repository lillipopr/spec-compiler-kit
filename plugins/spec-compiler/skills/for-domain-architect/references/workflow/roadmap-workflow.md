# Roadmap 工作流

> **核心理念**：Roadmap-First - 执行前生成完整 Roadmap，透明展示整体计划

---

## 为什么需要 Roadmap

### 问题分析

| 问题 | 说明 | 影响 |
|------|------|------|
| **流程不透明** | 用户不知道整个过程 | 体验差 |
| **预期不明确** | 不知道要花多少步 | 焦虑 |
| **进度不可见** | 不知道走到哪一步 | 迷茫 |
| **质量不确定** | 不知道质量关卡在哪 | 不信任 |

### Roadmap 的优势

| 优势 | 说明 | 效果 |
|------|------|------|
| **全局可见** | 一眼看到整个流程 | 心中有数 |
| **步骤透明** | 每一步都清晰展示 | 可预期 |
| **依赖明确** | 看到任务依赖关系 | 理解顺序 |
| **质量关卡** | 看到质量检查点 | 信任质量 |

---

## Roadmap 结构

### 模板

```markdown
# 领域设计文档生成 Roadmap

## 概览
- **目标**：从 PRD 生成领域设计文档
- **预计步骤**：12 个主要阶段
- **预计时间**：根据 PRD 复杂度
- **质量关卡**：每章 ≥60 分，综合 ≥90 分

## 执行计划

### 阶段 1：PRD 分析与摘要 [T1]
- **目标**：生成轻量级 PRD 摘要
- **输入**：原始 PRD 文档
- **输出**：prd-summary.md
- **依赖**：无
- **质量关卡**：无

### 阶段 2：第一章 - 限界上下文设计 [T2-T5]

#### T2: 第一章 PDCA #1 - Principles 检测
- **目标**：基于 principles 生成并检测问题
- **输出**：chapter-01-v1.md + issues-principles.md
- **依赖**：T1
- **质量关卡**：修复所有 principles 问题

#### T3: 第一章 PDCA #2 - Checklists 检测
- **目标**：基于 checklists 检测问题
- **输出**：chapter-01-v2.md + issues-checklists.md
- **依赖**：T2
- **质量关卡**：通过所有检查清单项

#### T4: 第一章 PDCA #3 - Scoring 检测
- **目标**：基于 scoring 检测问题并评分
- **输出**：chapter-01.md + chapter-01-score.md
- **依赖**：T3
- **质量关卡**：≥60 分

#### T5: 第一章人工 Review
- **目标**：等待人类审核确认
- **依赖**：T4
- **类型**：交互型

### 阶段 3-6：第二-五章（结构同阶段 2）

### 阶段 7：文档组装 [T-final]
- **目标**：组装最终文档
- **依赖**：所有章节完成
- **输出**：{功能名称}-领域设计文档.md
```

---

## Roadmap 生成流程

### 步骤

```
输入：PRD 文档
  ↓
Step 1：分析 PRD 复杂度
  - 识别功能数量
  - 识别实体数量
  - 识别流程数量
  ↓
Step 2：生成 Roadmap
  - 根据复杂度估算步骤
  - 标注质量关卡
  - 标注交互点
  ↓
Step 3：展示 Roadmap
  - 展示完整 Roadmap
  - 说明预计时间
  - 等待用户确认
  ↓
Step 4：开始执行
  - 用户确认后开始
  - 逐步执行 Roadmap
  - 实时更新进度
```

---

## Roadmap 元素

### 任务类型

| 类型 | 图标 | 说明 | 示例 |
|------|------|------|------|
| **分析型** | [T1] | 分析任务 | PRD 分析 |
| **生成型** | [T2-T5] | 生成任务（含 PDCA） | 章节生成 |
| **交互型** | [T5] | 需要用户确认 | 人工 Review |
| **组装型** | [T-final] | 组装任务 | 文档组装 |

### 质量关卡标注

```markdown
- **质量关卡**：≥60 分 → 必须达到 60 分
- **质量关卡**：通过检查清单 → 必须通过所有检查项
- **质量关卡**：无 → 无质量要求
```

### 依赖关系标注

```markdown
- **依赖**：无 → 无前置任务
- **依赖**：T1 → 依赖 T1 完成
- **依赖**：T1,T2 → 依赖 T1 和 T2 完成
```

---

## Roadmap 更新

### 进度更新

执行过程中实时更新 Roadmap：

```markdown
## 执行进度

### 已完成
✅ T1: PRD 分析与摘要
✅ T2-T5: 第一章 - 限界上下文设计

### 进行中
🔄 T6-T9: 第二章 - 聚合设计

### 待执行
⏳ T10-T13: 第三章 - 领域服务设计
⏳ T14-T17: 第四章 - 应用层设计
⏳ T18-T21: 第五章 - 入口层设计
⏳ T-final: 文档组装
```

### 状态变更

| 状态 | 图标 | 说明 |
|------|------|------|
| **待执行** | ⏳ | 尚未开始 |
| **进行中** | 🔄 | 正在执行 |
| **已完成** | ✅ | 已完成 |
| **失败** | ❌ | 执行失败 |
| **重试** | 🔁 | 正在重试 |

---

## 实时进度显示

### 进度条

```
==================================================
Roadmap 进度：1/5 (20%)
==================================================
✅ 已完成: 1 章节
🔄 进行中: 1 章节
⏳ 待执行: 3 章节
==================================================
✅ T1: PRD 分析与摘要
✅ T2-T5: 第一章 - 限界上下文设计 [Review 通过]
🔄 T6-T9: 第二章 - 聚合设计 [PDCA #1]
⏳ T10-T13: 第三章 - 领域服务设计
⏳ T14-T17: 第四章 - 应用层设计
⏳ T18-T21: 第五章 - 入口层设计
⏳ T-final: 文档组装
```

### 当前阶段详情

```markdown
## 当前阶段：T6-T9 第二章 - 聚合设计

### 当前步骤：T6 PDCA #1 - Principles 检测

**目标**：基于 principles 生成并检测问题

**进度**：
- ✅ 读取章节指令
- ✅ 读取聚合原则
- ✅ 生成初稿
- 🔄 检测 principles 问题
- ⏳ 修复问题
- ⏳ 输出 v1 版本
```

---

## Roadmap 交互点

### 人工 Review 点

```markdown
#### T5: 第一章人工 Review
- **目标**：等待人类审核确认
- **依赖**：T4
- **类型**：交互型

**系统提示**：
> 第一章已完成生成和自检。
> - 评分：85/100
> - 问题记录：issues-principles.md, issues-checklists.md
> - 章节文件：chapter-01.md
>
> 请审核以下内容：
> 1. 查看章节文件
> 2. 查看评分报告
> 3. 查看问题记录
>
> 输入 "继续" 进入下一章，或提出修改意见
```

### 用户响应处理

| 用户输入 | 系统响应 |
|---------|---------|
| "继续" | 标记 Review 通过，进入下一章 |
| "修改..." | 执行修改，重新 Review |
| "查看详情" | 显示更多细节信息 |

---

## Roadmap 质量保证

### 质量关卡汇总

| 关卡 | 位置 | 标准 | 处理 |
|------|------|------|------|
| **关卡1** | PDCA #1 | 修复所有 principles 问题 | 重试 |
| **关卡2** | PDCA #2 | 通过所有检查清单项 | 重试 |
| **关卡3** | PDCA #3 | ≥60 分 | 重试 |
| **关卡4** | 人工 Review | 用户确认 | 等待 |

### 重试机制

每个 PDCA 循环最多重试 3 次：
- 3 次重试后仍不通过 → 记录问题 → 人工介入

---

## 最佳实践

### DO ✅

- ✅ 执行前先展示完整 Roadmap
- ✅ 明确标注每个任务的目标和输出
- ✅ 清晰标注质量关卡
- ✅ 实时更新进度状态
- ✅ 在交互点暂停等待用户确认

### DON'T ❌

- ❌ 开始执行后再展示 Roadmap
- ❌ 任务描述含糊不清
- ❌ 质量关卡不明确
- ❌ 不更新进度状态
- ❌ 跳过交互点直接执行

---

## 示例 Roadmap

```markdown
# 会员管理系统 - 领域设计文档生成 Roadmap

## 概览
- **目标**：从会员管理 PRD 生成领域设计文档
- **预计步骤**：18 个主要阶段
- **预计时间**：约 45-60 分钟
- **质量关卡**：每章 ≥60 分，综合 ≥90 分

## 执行计划

### 阶段 1：PRD 分析与摘要 [T1] ✅
- **目标**：生成轻量级 PRD 摘要
- **输出**：prd-summary.md
- **状态**：已完成

### 阶段 2：第一章 - 限界上下文设计 [T2-T5] ✅
- **目标**：生成第一章内容
- **输出**：chapter-01.md
- **状态**：已完成（Review 通过）

### 阶段 3：第二章 - 聚合设计 [T6-T9] 🔄
- **目标**：生成第二章内容
- **输出**：chapter-02.md
- **状态**：进行中（PDCA #1）

### 阶段 4-6：第三-五章 ⏳

### 阶段 7：文档组装 [T-final] ⏳

## 当前进度：2/5 (40%)
```

---

## 总结

通过 Roadmap 工作流，可以：

1. **透明展示**：执行前让用户看到完整计划
2. **步骤明确**：每个步骤的目标和输出都清晰
3. **质量可控**：质量关卡清晰可见
4. **进度实时**：实时更新执行进度
5. **交互友好**：在关键点等待用户确认

Roadmap 是整个工作流系统的入口，是用户理解和信任系统的第一步。
