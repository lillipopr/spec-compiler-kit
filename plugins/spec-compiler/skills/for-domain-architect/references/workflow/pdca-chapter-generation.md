# PDCA 章节生成流程

> **核心理念**：Checklists 驱动的 PDCA - 每章生成经历 1 个 PDCA 循环，通过检查清单确保质量

---

## 为什么需要 PDCA 循环

PDCA 循环解决一次生成质量不稳定、问题发现太晚的问题：通过检查清单检测问题，确保内容完整且符合要求，早发现早修复降低成本。

---

## PDCA 循环结构

### Checklists 驱动的 PDCA

```
输入：PRD 摘要 + 前序章节摘要
  ↓
┌─────────────────────────────────────────┐
│ PDCA：Checklists 检测                   │
│   P: 准备上下文（PRD + 章节指令 + 清单）│
│   D: 按照章节指南生成初稿               │
│   C: 使用 checklists 检测问题          │
│   A: 修复检测到的问题                  │
└─────────────────────────────────────────┘
  ↓ 输出：终稿 + checklists 问题记录
```

---

## PDCA：Checklists 检测

### 目标

基于检查清单检测并修复问题，确保内容完整且符合要求。

### 流程

```
P（计划）
  1. 读取 PRD 摘要
  2. 读取前序章节摘要（如果有）
  3. 读取章节指令
  4. 读取对应检查清单
  ↓
D（执行）
  1. 基于章节指令生成内容
  2. 参考前序章节保持一致性
  3. 输出初稿
  ↓
C（检查）
  1. 逐项检查清单
  2. 检查内容是否满足
  3. 标记不满足项
  4. 生成检查报告
  ↓
A（处理）
  1. 修复不满足项
  2. 重新检查
  3. 所有项通过后输出终稿
  4. 输出检查问题记录
```

### 输入

| 输入项 | 文件路径 | 说明 |
|-------|---------|------|
| PRD 摘要 | `output/prd-summary.md` | 功能概述、实体、流程 |
| 前序摘要 | `output/chapter-{N-1}-summary.md` | 前一章的关键内容（可选） |
| 章节指令 | `references/chapter-instructions/chapter-xx.md` | 生成指令 |
| 检查清单 | `references/checklists/chapter-xx-checklist.md` | 检查清单 |

### 输出

| 输出项 | 文件路径 | 说明 |
|-------|---------|------|
| 终稿 | `output/chapter-xx.md` | 最终内容 |
| 问题记录 | `output/chapter-xx-issues-checklists.md` | 检查问题清单 |
| 章节摘要 | `output/chapter-xx-summary.md` | 供后续章节参考 |

### 检查清单模板

```markdown
# Checklist 问题记录 - 第 X 章

## 检查结果

### 通过项
- ✅ {检查项 1}
- ✅ {检查项 2}

### 不通过项
- ❌ {检查项 3}
  - **要求**：{具体要求}
  - **问题**：{具体问题}
  - **修复**：{修复方案}

## 修复结果
- 所有检查项已通过
```

---

## 质量关卡处理

### 重试机制

PDCA 循环最多重试 3 次：

```
for (let attempt = 1; attempt <= 3; attempt++) {
  const result = executePDCACycle();

  if (result.allItemsPassed) {
    return result;
  }

  if (attempt < 3) {
    // 重试
    continue;
  } else {
    // 3 次重试后仍失败
    return {
      status: 'failed',
      message: `${attempt} 次重试后仍未通过，需要人工介入`
    };
  }
}
```

### 失败处理

| 条件 | 处理方式 |
|------|---------|
| 3 次重试后仍有检查项不通过 | 记录问题，人工介入 |

---

## 完整示例：第二章生成

### PDCA 执行

```markdown
## 输入准备
- PRD 摘要：output/prd-summary.md
- 第一章摘要：output/chapter-01-summary.md
- 章节指令：references/chapter-instructions/chapter-02-aggregate.md
- 检查清单：references/checklists/chapter-02-checklist.md

## 执行步骤
1. 读取聚合设计指令
2. 识别聚合根（会员、订单、优惠券...）
3. 设计聚合边界
4. 设计聚合根行为
5. 生成初稿

## 检查结果
- ✅ 聚合根识别正确
- ✅ 聚合边界清晰
- ❌ 缺少事件发布设计

## 修复
- 添加事件发布设计
- 重新检查通过

## 输出
- 终稿：output/chapter-02.md
- 问题记录：output/chapter-02-issues-checklists.md
- 章节摘要：output/chapter-02-summary.md
```

---

## 进度显示

### PDCA 进度

```
==================================================
第二章：聚合设计 - PDCA 进度
==================================================
🔄 Checklists 检测（检查中...）
==================================================
通过项：3 / 5
待修复：2 项
```

### 单个 PDCA 内部进度

```
🔄 Checklists 检测
  ✅ P: 准备上下文
  ✅ D: 生成内容
  ✅ C: 检查问题
  🔄 A: 修复问题
  ↓
  即将完成...
```

---

## 最佳实践

### DO ✅

- ✅ 完整执行 PDCA 四个步骤
- ✅ 生成详细的问题记录
- ✅ 所有检查项通过才输出终稿
- ✅ 失败后分析原因再重试

### DON'T ❌

- ❌ 跳过检查直接输出
- ❌ PDCA 步骤不完整
- ❌ 不生成问题记录
- ❌ 不达到质量关卡就继续
- ❌ 盲目重试不分析原因

---

## 总结

通过 Checklists 驱动的 PDCA 循环：

1. **P（计划）**：准备 PRD 摘要、章节指令、检查清单
2. **D（执行）**：按照章节指令生成内容
3. **C（检查）**：使用检查清单逐项验证
4. **A（处理）**：修复问题直到所有项通过

这个简化的 PDCA 循环确保每章内容完整且符合要求，同时保持流程简洁高效。
